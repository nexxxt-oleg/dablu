document.addEventListener("DOMContentLoaded", () => {

    function setEqualHeight(elements) {
        var mainDivs = document.querySelectorAll(elements);
        var maxHeight = 0;
        for (var i = 0; i < mainDivs.length; ++i) {
            if (maxHeight < mainDivs[i].clientHeight) {
                maxHeight = mainDivs[i].clientHeight;
            }
        }
        if (maxHeight > 0) {
            for (var i = 0; i < mainDivs.length; ++i) {
                mainDivs[i].style.minHeight = maxHeight + "px";
            }
        }
    }


    if (document.getElementById('homeSlider')) {
        new Swiper('#homeSlider', {
            spaceBetween: 30,
            navigation: {
                nextEl: '.home-slider .swiper-next',
                prevEl: '.home-slider .swiper-prev',
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
        });
    }

    if (document.getElementsByClassName("js-slider-cat").length) {

        const slCat = document.querySelectorAll('.js-slider-cat');

        slCat.forEach(el => {
            let parentBox = el.parentNode;
            let nextSl = parentBox.querySelector('.swiper-next');
            let prevSl = parentBox.querySelector('.swiper-prev');
            let pagSl = parentBox.querySelector('.swiper-scrollbar');

            new Swiper(el, {
                spaceBetween: 30,
                slidesPerView: 4,
                navigation: {
                    nextEl: nextSl,
                    prevEl: prevSl,
                },
                scrollbar: {
                    el: pagSl,
                    draggable: true,
                },
                breakpoints: {
                    300: {
                        slidesPerView: 2,
                        spaceBetween: 20
                    },
                    768: {
                        slidesPerView: 2,
                        spaceBetween: 30
                    },
                    991: {
                        slidesPerView: 3,
                        spaceBetween: 30
                    },
                    1199: {
                        slidesPerView: 4,
                        spaceBetween: 30
                    }
                },
                on: {
                    init: function () {
                        setEqualHeight('.js-slider-cat .product-folder__body');
                    },
                    resize: function () {
                        setEqualHeight('.js-slider-cat .product-folder__body');
                    }
                },
            });
        });
    }

    if (document.getElementById('brendsSl')) {
        new Swiper('#brendsSl', {
            spaceBetween: 30,
            slidesPerView: 'auto',
            navigation: {
                nextEl: '#brendsNext',
                prevEl: '#brendsPrev',
            },
            /* breakpoints: {
                 320: {
                     slidesPerView: 2,
                     spaceBetween: 20
                 },
                 768: {
                     slidesPerView: 3,
                     spaceBetween: 30
                 },
                 991: {
                     slidesPerView: 4,
                     spaceBetween: 30
                 }
             }*/

        });
    }
    if (document.getElementById('brendsSl2')) {
        new Swiper('#brendsSl2', {
            spaceBetween: 30,
            slidesPerView: 6,
            navigation: {
                nextEl: '#brendsNext2',
                prevEl: '#brendsPrev2',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 20
                },
                768: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
                991: {
                    slidesPerView: 4,
                    spaceBetween: 30
                },
                1200: {
                    slidesPerView: 6,
                    spaceBetween: 30
                }
            }
        });
    }

    if (document.getElementById('gallerySl')) {
        new Swiper('#gallerySl', {
            spaceBetween: 30,
            navigation: {
                nextEl: '#gallerySlNext',
                prevEl: '#gallerySlPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 20
                },
                768: {
                    slidesPerView: 1,
                    spaceBetween: 30
                }
            }

        });
    }


    Fancybox.bind("[data-fancybox]", {
        // Your custom options
    });

    if (document.getElementsByClassName("js-mask-phone").length) {
        const inpMask = document.querySelectorAll('.js-mask-phone');
        inpMask.forEach(el => {
            let im = new Inputmask("+7(999) 999-99-99", {"clearIncomplete": true});
            im.mask(el);
        });
    }


    /*if(document.getElementById('searchHeader')) {
        let rect = document.getElementById('searchHeader').getBoundingClientRect();
        let searchRes = document.getElementById('searchRes');
        searchRes.style.top = rect.bottom + 'px';
        searchRes.style.left = rect.left + 'px';
        document.getElementById('searchHeader').addEventListener('input', function() {
            searchRes.style.display = 'block';
        });
    }*/

    document.getElementById('mobSearchOpen').addEventListener('click', function () {
        document.getElementById('searchTop').classList.toggle('show');
    });

    document.getElementById('mobSearchOpen').addEventListener('click', function () {
        document.getElementById('searchTop').classList.add('show');
    });

    document.getElementById('searchClose').addEventListener('click', function () {
        document.getElementById('searchTop').classList.remove('show');
    });

    if (document.getElementById('moreText')) {
        new Readmore('#moreText', {
            speed: 75,
            collapsedHeight: 148,
            moreLink: '<a href="#" class="js-more-link">Читать дальше <i class="down"></i></a>',
            lessLink: '<a href="#" class="js-more-link">Скрыть <i class="up"></i></a>'
        });
    }

    if (document.getElementById('openFilter')) {
        document.getElementById('openFilter').addEventListener('click', function () {
            document.getElementById('catalogFilter').classList.add('show');
            document.body.classList.add('show_filter');
        });
    }
    if (document.getElementById('catalogFilterClose')) {
        document.getElementById('catalogFilterClose').addEventListener('click', function () {
            document.getElementById('catalogFilter').classList.remove('show');
            document.body.classList.remove('show_filter');
        });
    }

    if (document.getElementById('thumbnail')) {
        let thumbnail = new Swiper('#thumbnail', {
            slidesPerView: 6,
            direction: 'vertical',
            watchSlidesProgress: true,
            navigation: {
                nextEl: '#thumbnailNext',
                prevEl: '#thumbnailPrev',
            },
        });

        let productSl = new Swiper('#productImg', {
            thumbs: {
                swiper: thumbnail,
            },
            spaceBetween: 10,
            pagination: {
                el: '#productImg .swiper-pagination',
                clickable: true,
            },
            on: {
                init: function (sw) {
                    if (sw.slides.length > 6) {
                        document.getElementById('thumbnailLeft').classList.add('show-nav');
                    }
                },
            },
        });
    }

    if (document.getElementById('propsList')) {
        new Readmore('#propsList', {
            speed: 75,
            collapsedHeight: 182,
            moreLink: '<a href="#" class="js-more-link"><span>Показать все характеристики <i class="down"></i></span></a>',
            lessLink: '<a href="#" class="js-more-link"><span>Скрыть <i class="up"></i></span></a>'
        });
    }

    if (document.getElementById('watchedSlider')) {
        new Swiper('#watchedSlider', {
            spaceBetween: 30,
            slidesPerView: 4,
            navigation: {
                nextEl: '#watchedSliderNext',
                prevEl: '#watchedSliderPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 10
                },
                768: {
                    slidesPerView: 3,
                    spaceBetween: 30
                },
                991: {
                    slidesPerView: 4,
                    spaceBetween: 30
                }
            }

        });
    }


    if (document.getElementById('brandsList')) {
        mixitup(document.getElementById('brandsList'));
    }


    if (document.getElementById('descBrand')) {
        new Readmore('#descBrand', {
            speed: 75,
            collapsedHeight: 67,
            moreLink: '<a href="#" class="js-more-link"><span>Читать дальше <i class="down"></i></span></a>',
            lessLink: '<a href="#" class="js-more-link"><span>Скрыть <i class="up"></i></span></a>'
        });
    }

    if (document.getElementById('deliveryTabs') && window.innerWidth < 575) {

        let tags = document.querySelectorAll('#deliveryTabs .nav-link');
        [].forEach.call(tags, function (elem) {
            elem.parentNode.style.width = elem.offsetWidth + 'px';
        });

        new Swiper("#deliveryTabs", {
            spaceBetween: 20,
            slidesPerView: 'auto',
            allowTouchMove: false,

            breakpoints: {
                300: {
                    allowTouchMove: true
                },
                700: {
                    allowTouchMove: true
                },
                1200: {
                    allowTouchMove: false
                },
            }
        });
    }

    let tels = document.querySelectorAll('.js-tel-mask');
    [].forEach.call(tels, function (elem) {
        let im = new Inputmask("+7 (999) 999-99-99");
        im.mask(elem);
    });


    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl));

});